<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Vista de Cuadrícula</title>
    <style>
        .grid {
            display: grid;
            grid-template-columns: repeat(20, 40px); /* 20 columnas */
            grid-template-rows: repeat(15, 40px); /* 15 filas */
            gap: 1px;
        }
        .cell {
        width: 40px;
        height: 40px;
        border: 1px solid black;
        background-color: lightgray;
        display: flex;
        align-items: flex-start; /* Cambiar la alineación vertical */
        justify-content: center;
        cursor: pointer;
        position: relative; /* Para posicionar los valores absolutos */
    }

    .valueG {
        font-size: 10px; /* Tamaño más pequeño */
        position: absolute; /* Posición absoluta */
        top: 2px; /* Separación desde la parte superior */
        left: 2px; /* Separación desde la izquierda */
    }

    .valueH {
        font-size: 10px; /* Tamaño más pequeño */
        position: absolute; /* Posición absoluta */
        top: 2px; /* Separación desde la parte superior */
        right: 2px; /* Separación desde la derecha */
    }

    .valueTotal {
        font-size: 10px; /* Tamaño más pequeño */
        position: absolute; /* Posición absoluta */
        bottom: 2px; /* Separación desde la parte inferior */
        left: 50%; /* Centrar horizontalmente */
        transform: translateX(-50%); /* Centrar horizontalmente */
    }
        .cell.partida {
            background-color: red;
        }
        .cell.destino {
            background-color: blue;
        }
        .cell.adyacente {
            background-color: yellow;
        }
        .cell .value {
            position: absolute;
            top: 2px;
            left: 2px;
            font-size: 12px;
            color: black;
        }
        .input-group {
            margin-bottom: 10px;
        }
        .error-message {
            color: red;
            font-weight: bold;
            display: none; /* Ocultamos el mensaje de error por defecto */
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>Vista de Cuadrícula</h1>
    
    <!-- Inputs para mostrar los valores del eje X y Y -->
    <div class="input-group">
        <label for="x-partida">Valor del Eje X (Partida):</label>
        <input type="text" id="x-partida" readonly>
    </div>
    <div class="input-group">
        <label for="y-partida">Valor del Eje Y (Partida):</label>
        <input type="text" id="y-partida" readonly>
    </div>
    <div class="input-group">
        <label for="x-destino">Valor del Eje X (Destino):</label>
        <input type="text" id="x-destino" readonly>
    </div>
    <div class="input-group">
        <label for="y-destino">Valor del Eje Y (Destino):</label>
        <input type="text" id="y-destino" readonly>
    </div>

    <!-- Botón para alternar entre partida y destino -->
    <button id="toggle-mode">Modo: Partida</button>
    
    <!-- Botón para validar selección de partida y destino -->
    <button id="validate-selection">Validar Partida y Destino</button>
    
    <!-- Botón para calcular las celdas adyacentes -->
    <button id="calculate-adjacent">Calcular Celdas Adyacentes</button>

    <!-- Mensaje de error -->
    <div class="error-message" id="error-message">Error: Debe seleccionar un punto de partida y un punto de destino.</div>

    <div class="grid" id="grid"></div>

    <script>
        const rows = 15;
        const cols = 20;

        const grid = document.getElementById('grid');
        for (let row = 0; row < rows; row++) {
            for (let col = 0; col < cols; col++) {
                const cell = document.createElement('div');
                cell.classList.add('cell');
                cell.setAttribute('data-row', row);
                cell.setAttribute('data-col', col);
                cell.addEventListener('click', cellClicked);
                grid.appendChild(cell);
            }
        }

        let selectedPartida = null;
        let selectedDestino = null;
        let isPartidaMode = true;

        const xPartidaInput = document.getElementById('x-partida');
        const yPartidaInput = document.getElementById('y-partida');
        const xDestinoInput = document.getElementById('x-destino');
        const yDestinoInput = document.getElementById('y-destino');
        const toggleButton = document.getElementById('toggle-mode');
        const validateButton = document.getElementById('validate-selection');
        const calculateButton = document.getElementById('calculate-adjacent');
        const errorMessage = document.getElementById('error-message');

        let adyacentes = [];  // Lista para guardar celdas adyacentes

        toggleButton.addEventListener('click', function() {
            isPartidaMode = !isPartidaMode;
            toggleButton.textContent = isPartidaMode ? "Modo: Partida" : "Modo: Destino";
        });

        validateButton.addEventListener('click', function() {
            if (!selectedPartida || !selectedDestino) {
                errorMessage.style.display = 'block';
            } else {
                errorMessage.style.display = 'none';
                alert("Partida y destino seleccionados correctamente.");
            }
        });

        calculateButton.addEventListener('click', function() {
            if (selectedPartida) {
                errorMessage.style.display = 'none';
                limpiarAdyacentes(); // Limpiamos las celdas adyacentes anteriores
                calcularAdyacentes(selectedPartida); // Calculamos las nuevas celdas adyacentes
            } else {
                errorMessage.style.display = 'block';
                errorMessage.textContent = 'Error: Debe seleccionar un punto de partida.';
            }
        });

        function cellClicked(event) {
            const clickedCell = event.target;
            const row = parseInt(clickedCell.getAttribute('data-row'));
            const col = parseInt(clickedCell.getAttribute('data-col'));

            if (isPartidaMode) {
                if (selectedPartida) {
                    selectedPartida.classList.remove('partida');
                }
                selectedPartida = clickedCell;
                selectedPartida.classList.add('partida');
                xPartidaInput.value = col;
                yPartidaInput.value = row;
            } else {
                if (selectedDestino) {
                    selectedDestino.classList.remove('destino');
                }
                selectedDestino = clickedCell;
                selectedDestino.classList.add('destino');
                xDestinoInput.value = col;
                yDestinoInput.value = row;
            }
        }

        function calcularAdyacentes(partidaCell) {
            const partidaRow = parseInt(partidaCell.getAttribute('data-row'));
            const partidaCol = parseInt(partidaCell.getAttribute('data-col'));
            adyacentes = []; // Limpiar la lista de adyacentes

            const direcciones = [
                { row: -1, col: 0, valor: 10 },  // Arriba
                { row: 1, col: 0, valor: 10 },   // Abajo
                { row: 0, col: -1, valor: 10 },  // Izquierda
                { row: 0, col: 1, valor: 10 },   // Derecha
                { row: -1, col: -1, valor: 14 }, // Diagonal arriba-izquierda
                { row: -1, col: 1, valor: 14 },  // Diagonal arriba-derecha
                { row: 1, col: -1, valor: 14 },  // Diagonal abajo-izquierda
                { row: 1, col: 1, valor: 14 }    // Diagonal abajo-derecha
            ];

            let minF = Infinity; // Inicializar el mínimo F
            let mejorCelda = null; // Inicializar la mejor celda

            direcciones.forEach(dir => {
                const newRow = partidaRow + dir.row;
                const newCol = partidaCol + dir.col;

                if (newRow >= 0 && newRow < rows && newCol >= 0 && newCol < cols) {
                    const adyacenteCell = document.querySelector(`.cell[data-row='${newRow}'][data-col='${newCol}']`);
                    adyacenteCell.classList.add('adyacente');

                    // Añadimos el valor G en la esquina superior izquierda de la celda
                    let valorGElemento = adyacenteCell.querySelector('.valueG');
                    if (!valorGElemento) {
                        valorGElemento = document.createElement('div');
                        valorGElemento.classList.add('valueG');
                        adyacenteCell.appendChild(valorGElemento);
                    }
                    valorGElemento.textContent = dir.valor;

                    // Añadimos el valor H en la esquina superior derecha de la celda
                    const valorH = calcularDistancia(newRow, newCol) * 10; // Multiplicar H por 10
                    let valorHElemento = adyacenteCell.querySelector('.valueH');
                    if (!valorHElemento) {
                        valorHElemento = document.createElement('div');
                        valorHElemento.classList.add('valueH');
                        adyacenteCell.appendChild(valorHElemento);
                    }
                    valorHElemento.textContent = valorH;

                    // Calculamos y mostramos la suma de G + H (valor F) en el espacio restante
                    const valorF = dir.valor + valorH; // Suma de G + H
                    let valorTotalElemento = adyacenteCell.querySelector('.valueTotal');
                    if (!valorTotalElemento) {
                        valorTotalElemento = document.createElement('div');
                        valorTotalElemento.classList.add('valueTotal');
                        adyacenteCell.appendChild(valorTotalElemento);
                    }
                    valorTotalElemento.textContent = valorF;

                    // Guardamos la celda en la lista de adyacentes
                    adyacentes.push({
                        row: newRow,
                        col: newCol,
                        valorG: dir.valor,
                        valorH: valorH,
                        valorF: valorF
                    });

                    // Comprobamos si es el mínimo F
                    if (valorF < minF) {
                        minF = valorF; // Actualizar el mínimo F
                        mejorCelda = adyacenteCell; // Actualizar la mejor celda
                    }
                }
            });

            // Colorear la mejor celda de azul grisáceo claro
            if (mejorCelda) {
                mejorCelda.style.backgroundColor = '#A3B7C2'; // Color azul grisáceo claro
            }

            console.log('Celdas adyacentes:', adyacentes);
        }

        // Función para calcular la distancia H (distancia a la celda destino)
        function calcularDistancia(row, col) {
            if (selectedDestino) {
                const destinoRow = parseInt(selectedDestino.getAttribute('data-row'));
                const destinoCol = parseInt(selectedDestino.getAttribute('data-col'));
                
                // Utiliza la distancia Manhattan como ejemplo
                return Math.abs(destinoRow - row) + Math.abs(destinoCol - col);
            }
            return 0; // Si no hay destino, devuelve 0
        }
        function limpiarAdyacentes() {
            // Eliminamos la clase 'adyacente' de todas las celdas adyacentes previamente seleccionadas
            adyacentes.forEach(celda => {
                const cellElement = document.querySelector(`.cell[data-row='${celda.row}'][data-col='${celda.col}']`);
                cellElement.classList.remove('adyacente');
                
                // Limpiamos el texto de valor si existe
                const valorElemento = cellElement.querySelector('.value');
                if (valorElemento) {
                    valorElemento.remove();
                }
            });

            // Limpiamos la lista de celdas adyacentes
            adyacentes = [];
        }
    </script>
</body>
</html>
